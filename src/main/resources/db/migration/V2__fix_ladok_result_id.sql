-- Fix Ladok result_id so Hibernate @GeneratedValue(IDENTITY) works

-- 1) Ensure result_id is BIGINT
ALTER TABLE ladok.result
    ALTER COLUMN result_id TYPE BIGINT;

-- 2) Add identity generation if not already present
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1
        FROM information_schema.columns
        WHERE table_schema = 'ladok'
          AND table_name = 'result'
          AND column_name = 'result_id'
          AND is_identity = 'YES'
    ) THEN
        ALTER TABLE ladok.result
            ALTER COLUMN result_id
            ADD GENERATED BY DEFAULT AS IDENTITY;
    END IF;
END$$;